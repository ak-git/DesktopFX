plugins {
    id 'java-library'
}

configurations {
    mockitoAgent
}

dependencies {
    api project(':Util')
    api libs.jserial.comm
    api libs.measure.unit.api
    api libs.javax.json
    implementation libs.jspecify
    implementation libs.tech.units

    implementation(platform(libs.junit))
    implementation libs.junit.jupiter.api
    implementation libs.mockito.junit
    testImplementation libs.mockito.core
    testImplementation libs.bundles.test.implementation
    testCompileOnly libs.bundles.test.compile
    testRuntimeOnly libs.bundles.test.runtime

    mockitoAgent(libs.mockito.core) {
        transitive = false
    }
}

tasks.withType(Test).configureEach {
    jvmArgs('--enable-native-access=ALL-UNNAMED')
}

tasks.withType(JavaExec).configureEach {
    jvmArgs('--enable-native-access=ALL-UNNAMED')
}

tasks {
    test {
        jvmArgs += "-javaagent:${configurations.mockitoAgent.asPath}"
    }
}